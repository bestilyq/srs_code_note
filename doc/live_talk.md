<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:宋体;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:"\@宋体";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:"Calibri",sans-serif;}
h1
	{mso-style-link:"标题 1 字符";
	margin-top:17.0pt;
	margin-right:0cm;
	margin-bottom:16.5pt;
	margin-left:0cm;
	text-align:justify;
	text-justify:inter-ideograph;
	line-height:240%;
	page-break-after:avoid;
	font-size:22.0pt;
	font-family:"Calibri",sans-serif;
	font-weight:bold;}
h2
	{mso-style-link:"标题 2 字符";
	margin-top:13.0pt;
	margin-right:0cm;
	margin-bottom:13.0pt;
	margin-left:0cm;
	text-align:justify;
	text-justify:inter-ideograph;
	line-height:173%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Cambria",serif;
	font-weight:bold;}
h3
	{mso-style-link:"标题 3 字符";
	margin-top:13.0pt;
	margin-right:0cm;
	margin-bottom:13.0pt;
	margin-left:0cm;
	text-align:justify;
	text-justify:inter-ideograph;
	line-height:173%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Calibri",sans-serif;
	font-weight:bold;}
h4
	{mso-style-link:"标题 4 字符";
	margin-top:14.0pt;
	margin-right:0cm;
	margin-bottom:14.5pt;
	margin-left:0cm;
	text-align:justify;
	text-justify:inter-ideograph;
	line-height:156%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria",serif;
	font-weight:bold;}
h5
	{mso-style-link:"标题 5 字符";
	margin-top:14.0pt;
	margin-right:0cm;
	margin-bottom:14.5pt;
	margin-left:0cm;
	text-align:justify;
	text-justify:inter-ideograph;
	line-height:156%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Calibri",sans-serif;
	font-weight:bold;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:"Calibri",sans-serif;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:21.0pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:"Calibri",sans-serif;}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:42.0pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
p
	{margin-right:0cm;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"批注框文本 字符";
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:9.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoNoSpacing, li.MsoNoSpacing, div.MsoNoSpacing
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:21.0pt;
	font-size:10.5pt;
	font-family:"Calibri",sans-serif;}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
	{margin-top:24.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria",serif;
	color:#365F91;
	font-weight:bold;}
span.1
	{mso-style-name:"标题 1 字符";
	mso-style-link:"标题 1";
	font-weight:bold;}
span.2
	{mso-style-name:"标题 2 字符";
	mso-style-link:"标题 2";
	font-family:"Cambria",serif;
	font-weight:bold;}
span.4
	{mso-style-name:"标题 4 字符";
	mso-style-link:"标题 4";
	font-family:"Cambria",serif;
	font-weight:bold;}
span.a
	{mso-style-name:"批注框文本 字符";
	mso-style-link:批注框文本;}
span.3
	{mso-style-name:"标题 3 字符";
	mso-style-link:"标题 3";
	font-weight:bold;}
span.5
	{mso-style-name:"标题 5 字符";
	mso-style-link:"标题 5";
	font-weight:bold;}
.MsoChpDefault
	{font-family:"Calibri",sans-serif;}
 /* Page Definitions */
 @page WordSection1
	{size:595.3pt 841.9pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	layout-grid:15.6pt;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>

</head>

<body lang=ZH-CN link=blue vlink=purple style='text-justify-trim:punctuation'>

<div class=WordSection1 style='layout-grid:15.6pt'>

<p class=MsoNormal><b><span style='font-size:26.0pt;font-family:宋体'>直播连麦方案设计</span></b></p>

<p class=MsoTocHeading><span style='font-family:宋体'>目录</span></p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc495916510">1 <span lang=EN-US
style='font-family:宋体'><span lang=EN-US>简介</span></span><span style='color:
windowtext;display:none;text-decoration:none'>... </span><span
style='color:windowtext;display:none;text-decoration:none'>1</span></a></span></p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc495916511"><span
style='background:white'>2 </span><span lang=EN-US style='font-family:宋体;
background:white'><span lang=EN-US>连麦互动主要性能指标</span></span><span
style='color:windowtext;display:none;text-decoration:none'>... </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></span></p>

<p class=MsoToc2><span lang=EN-US><a href="#_Toc495916512">2.1 <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>互动及时性</span></span><span
style='color:windowtext;display:none;text-decoration:none'>... </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></span></p>

<p class=MsoToc2><span lang=EN-US><a href="#_Toc495916513">2.2 <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>流畅性</span></span><span
style='color:windowtext;display:none;text-decoration:none'>... </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></span></p>

<p class=MsoToc2><span lang=EN-US><a href="#_Toc495916514">2.3 <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>跨平台互动</span></span><span
style='color:windowtext;display:none;text-decoration:none'>... </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></span></p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc495916515"><span
style='background:white'>3 </span><span lang=EN-US style='font-family:宋体;
background:white'><span lang=EN-US>常用连麦互动解决方案</span></span><span
style='color:windowtext;display:none;text-decoration:none'>... </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></span></p>

<p class=MsoToc2><span lang=EN-US><a href="#_Toc495916516"><span
style='background:white'>3.1 </span><span lang=EN-US style='font-family:宋体;
background:white'><span lang=EN-US>主播端混流</span></span><span style='color:windowtext;
display:none;text-decoration:none'>... </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></span></p>

<p class=MsoToc2><span lang=EN-US><a href="#_Toc495916517"><span
style='background:white'>3.2 </span><span lang=EN-US style='font-family:宋体;
background:white'><span lang=EN-US>服务器混流</span></span><span style='color:windowtext;
display:none;text-decoration:none'>... </span><span
style='color:windowtext;display:none;text-decoration:none'>3</span></a></span></p>

<p class=MsoToc2><span lang=EN-US><a href="#_Toc495916518">3.3 <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>方案比较</span></span><span
style='color:windowtext;display:none;text-decoration:none'>... </span><span
style='color:windowtext;display:none;text-decoration:none'>4</span></a></span></p>

<p class=MsoToc3><span lang=EN-US><a href="#_Toc495916519">3.3.1 <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>主播端混流</span></span><span
style='color:windowtext;display:none;text-decoration:none'>... </span><span
style='color:windowtext;display:none;text-decoration:none'>4</span></a></span></p>

<p class=MsoToc3><span lang=EN-US><a href="#_Toc495916520">3.3.2 <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>服务器端混流</span></span><span
style='color:windowtext;display:none;text-decoration:none'>... </span><span
style='color:windowtext;display:none;text-decoration:none'>5</span></a></span></p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc495916521">4 <span lang=EN-US
style='font-family:宋体'><span lang=EN-US>连麦互动方案设计</span></span><span
style='color:windowtext;display:none;text-decoration:none'>... </span><span
style='color:windowtext;display:none;text-decoration:none'>6</span></a></span></p>

<p class=MsoToc2><span lang=EN-US><a href="#_Toc495916522">4.1 <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>服务器混流方案设计</span></span><span
style='color:windowtext;display:none;text-decoration:none'>... </span><span
style='color:windowtext;display:none;text-decoration:none'>7</span></a></span></p>

<p class=MsoToc3><span lang=EN-US><a href="#_Toc495916523">4.1.1&nbsp; <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>互动直播</span></span>(<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>连麦</span></span>)<span
style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>7</span></a></span></p>

<p class=MsoToc3><span lang=EN-US><a href="#_Toc495916524">4.1.2&nbsp; <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>会议直播</span></span>(<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>旁路直播</span></span>)<span
style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>8</span></a></span></p>

<p class=MsoToc3><span lang=EN-US><a href="#_Toc495916525">4.1.3&nbsp; <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>客户端混流方案设计</span></span><span
style='color:windowtext;display:none;text-decoration:none'>... </span><span
style='color:windowtext;display:none;text-decoration:none'>9</span></a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h1><a name="_Toc495916510"><span lang=EN-US>1 </span></a><span
style='font-family:宋体'>简介</span></h1>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>在一般直播系统，主播与观众交互只能通过文字互动</span><span lang=EN-US
style='color:black;background:white'>,</span><span style='font-family:宋体;
color:black;background:white'>随着移动直播飞速发展，用户互动体验不断提交，其中连麦互动功能成为直播互动非常重要的功能，成为目前直播系统中标配功能。在传统直播中观众可以与主播发起实时连麦，或者主播与主播之间连麦，增加直播互动性，有更好的的用户体验。</span></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体'>连麦互动的实现可以为更多行业场景带来极大的体验提升。比如在线教育，口语老师的讲课过程中就可以让学生参与阅读发声，学生听到自己的发音同时结合老师及时发音纠正，能够达到很好的教学效果，这对在线教育来说是明显的进步</span></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>再比如越来越多的企业需要视频会议，同时也需要将会议信息同步推送到更多员工。过往大型企业的集团会议，总部领导在一个房间里开会，异地分公司的员工也集中在当地的演播厅，以观看视频听报告的形式来参与会议，而用移动手机会议直播，首先可以解决所有人不用集中在固定场所，参会人员之间通过视频连麦形式进行会议讨论，整个过程合成一个画面推送到各个员工手机端。这就是很典型的互动直播企业应用场景，降低开会成本提升开会效率的同时，更容易让一次会议做到很好的上传下达效果。</span></p>

<h1><a name="_Toc495916511"><span lang=EN-US style='color:black;background:
white'>2 </span></a><span style='font-family:宋体;color:black;background:white'>连麦互动主要性能指标</span></h1>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>如何怎么来判断互动直播的成熟度，可以从三个方面来看：</span></p>

<h2><a name="_Toc495916512"><strong><span lang=EN-US>2.1 </span></strong></a><strong><span
style='font-family:宋体'>互动及时性</span></strong></h2>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>互动及时也就是连麦的观众和主播之间需要高实时，这是正常视频通话的前提。假设及时性不好，很容易看到主播说话</span><span
lang=EN-US style='color:black;background:white'>10</span><span
style='font-family:宋体;color:black;background:white'>秒之后，连麦的观众才收到回应，这一画面感受会非常不好。</span></p>

<h2><a name="_Toc495916513"><strong><span lang=EN-US>2.2 </span></strong></a><strong><span
style='font-family:宋体'>流畅性</span></strong></h2>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>当连麦主播产生及时互动内容后，需要立刻以直播的形式传递给更多的观众，这时直播内容的流畅度、清晰度都会直接影响观众的视听体验。</span></p>

<h2><a name="_Toc495916514"><strong><span lang=EN-US>2.3 </span></strong></a><strong><span
style='font-family:宋体'>跨平台互动</span></strong></h2>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>当互动直播成为直播的常用形态，不论是观众还是主播在</span><span lang=EN-US
style='color:black;background:white'>PC</span><span style='font-family:宋体;
color:black;background:white'>、手机甚至是外设装备之间都可以发起连麦，在更多场景中进行实时互动，所以跨平台的支撑也将是一个挑战</span></p>

<h1><a name="_Toc495916515"><span lang=EN-US style='color:black;background:
white'>3 </span></a><span style='font-family:宋体;color:black;background:white'>常用连麦互动解决方案</span></h1>

<p class=MsoNoSpacing><span lang=EN-US>&nbsp; </span><span style='font-family:
宋体'>连麦互动可以说是传统的直播</span><span lang=EN-US>+</span><span style='font-family:宋体'>视频会议，一般有如下常用的解决方案</span></p>

<h2><a name="_Toc495916516"><span lang=EN-US style='color:black;background:
white'>3.1 </span></a><span style='font-family:宋体;color:black;background:white'>主播端混流</span></h2>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>该实现思路要求主播分别把自己的视频数据与连麦粉丝的视频数据合成，然后把合成好的视频流、主播自己的的音频数据、连麦粉丝的音频数据推给</span><span
lang=EN-US style='color:black;background:white'>CDN</span><span
style='font-family:宋体;color:black;background:white'>网络，并经由</span><span
lang=EN-US style='color:black;background:white'>CDN</span><span
style='font-family:宋体;color:black;background:white'>分发给所有观众。故主播端手机负担的任务更重，对手机性能和网络性能要求也比普通直播时更高一些。主播与粉丝连麦，主播端混流部分的基本流程如下图所示：</span></p>

<p class=MsoNormal><span lang=EN-US><img width=981 height=585 id="图片 2"
src="live_talk.files/image001.jpg"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p>

<h2><a name="_Toc495916517"><span lang=EN-US style='color:black;background:
white'>3.2 </span></a><span style='font-family:宋体;color:black;background:white'>服务器混流</span></h2>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>所有步骤和在推流端混流几乎一样，只不过工作环境不一样。所有的步骤都是服务端额外增加的工作量。服务端混流的工作内容和推流端混流不一样的地方在于：推流端解码是不管混流还是不混流都要做的事情，而服务端解码却是因为要混流才额外做的工作。混流是一个比较烧资源的事情，服务端是一个资源比较丰富的地方。</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><img width=1025 height=655 id="图片 4"
src="live_talk.files/image002.jpg"></span></p>

<p class=MsoNormal><span lang=EN-US><img width=1024 height=629
src="live_talk.files/image003.png"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2><a name="_Toc495916518"><span lang=EN-US>3.3 </span></a><span
style='font-family:宋体'>方案比较</span></h2>

<h3><a name="_Toc495916519"><span class=2><span lang=EN-US style='font-family:
"Calibri",sans-serif'>3.3.1 </span></span></a><span class=2><span
style='font-family:宋体'>主播端混流</span></span></h3>

<h4><strong><span style='font-family:宋体;font-weight:normal'>优点</span></strong></h4>

<p class=MsoNoSpacing><b><span lang=EN-US>1) </span></b><b><span
style='font-family:宋体'>成本点</span></b></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>整体来说，推流端混流是一个低成本的方案。它在两个方面降低成本：计算资源和网络带宽。本质上，在推流端混流就是服务端把混流的成本转嫁给推流端。服务端的计算资源和网络带宽都相对比较昂贵，而推流端的计算资源和网络带宽都是沉着成本。如果在推流端做混流，就降低了服务端的成本，充分利用了推流端能共享的资源</span></p>

<p class=MsoNoSpacing><b><span lang=EN-US style='color:black;background:white'>2)&nbsp;
</span></b><b><span style='font-family:宋体;color:black;background:white'>服务端压力小</span></b></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>在服务端混流是相对来说是集中的模式，这样会增加服务端的压力。在推流端混流是完全分布式的模式，这样可以降低服务端的压力。</span></p>

<p class=MsoNoSpacing><b><span lang=EN-US style='color:black;background:white'>3)&nbsp;
</span></b><b><span style='font-family:宋体;color:black;background:white'>本地输出混流后的数据</span></b></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>在推流端混流以后将会输出混流后的音视频流，这样方便本地进行录制，或者直接把音视频流推到</span><span
lang=EN-US style='color:black;background:white'>CDN</span><span
style='font-family:宋体;color:black;background:white'>网络进行分发。</span></p>

<h4><strong><span style='font-family:宋体;font-weight:normal'>缺点</span></strong></h4>

<p class=MsoNoSpacing><b><span lang=EN-US style='color:black;background:white'>1)
&nbsp;</span></b><b><span style='font-family:宋体;color:black;background:white'>增加额外延迟</span></b></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>首先，在推流端进行混流会增加额外的延迟，主要是因为要等待所有其它推流端的音视频流到达，才能开始混流。从图二我们可以看到，在服务端混流，只要所有主播的音视频流到达服务端，就可以开始混流；在推流端混流，要在前者的基础上，其它所有推流端的音视频流再被拉流到推流端，才能开始混流。这是额外的时间开销。其次，推流端混流完毕以后推流到</span><span
lang=EN-US style='color:black;background:white'>CDN</span><span
style='font-family:宋体;color:black;background:white'>网络的延迟也相对较大，因为推流端的硬件配置和上行带宽质量都无法和服务端相比。最后，考虑到推流端种种不稳定的情况，额外的延迟只会增多而不会减少。</span></p>

<p class=MsoNoSpacing><b><span lang=EN-US style='color:black;background:white'>2)
&nbsp;</span></b><b><span style='font-family:宋体;color:black;background:white'>手机硬件配置瓶颈</span></b></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>在推流端进行混流要求比较好的手机硬件配置。一般来说，目前主流的四核手机能满足连麦互动直播的要求。然而，如果算上混流的工作量，手机的硬件配置将会成为瓶颈。比如说，如果安卓手机采用软编，并且需要混的音视频流的数目比较多的话，手机会因为计算量较大而发热，很可能会导致摄像头（离</span><span
lang=EN-US style='color:black;background:white'>CPU</span><span
style='font-family:宋体;color:black;background:white'>比较近）采集视频的时候出现丢帧的现象。</span></p>

<p class=MsoNoSpacing><b><span lang=EN-US style='color:black;background:white'>3)&nbsp;
</span></b><b><span style='font-family:宋体;color:black;background:white'>上行网络带宽瓶颈</span></b></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>在推流端进行混流要求比较好的上行网络带宽。如果下行网络带宽是</span><span
lang=EN-US style='color:black;background:white'>100M bps</span><span
style='font-family:宋体;color:black;background:white'>，那么上行网络带宽相对应一般是</span><span
lang=EN-US style='color:black;background:white'>1M bps</span><span
style='font-family:宋体;color:black;background:white'>，好一点的会到</span><span
lang=EN-US style='color:black;background:white'>4M bps</span><span
style='font-family:宋体;color:black;background:white'>。一般情况下，音视频流平均的码率是</span><span
lang=EN-US style='color:black;background:white'>800k bps</span><span
style='font-family:宋体;color:black;background:white'>。推流端将会推两路流：原始的音视频流和混流后的音视频流，因此总共推流的码率大概是</span><span
lang=EN-US style='color:black;background:white'>1.6M bps</span><span
style='font-family:宋体;color:black;background:white'>。再考虑到网络带宽在上网人数较多的时间段会打折扣，和网络不稳定等情况，推流端的上行网络带宽往往是不能够满足推流端混流的要求的。</span></p>

<p class=MsoNoSpacing><b><span lang=EN-US style='color:black;background:white'>4)&nbsp;
</span></b><b><span style='font-family:宋体;color:black;background:white'>推流端环境不可控</span></b></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>综合上面第二和第三点，推流端的环境是不可控的。直播业务平台或者直播云服务平台都没办法管控推流端的硬件配置，使用习惯，网络信号和网络带宽等因素。因此，在推流端做混流的效果也是不可控的。</span></p>

<p class=MsoNoSpacing><b><span lang=EN-US style='color:black;background:white'>5)&nbsp;
</span></b><b><span style='font-family:宋体;color:black;background:white'>难以扩展</span></b></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>在音视频云服务方案设计阶段，方案一般是易于扩展的。随着直播业务平台的发展，对推流端的计算能力和网络带宽都将会有升级的要求。然而，推流端的环境是不可控的，而且也是难以扩展的。相对而言，在服务端做推流，如果要增加服务端的</span><span
lang=EN-US style='color:black;background:white'>CPU</span><span
style='font-family:宋体;color:black;background:white'>或者增加网络带宽，都是在音视频云服务平台掌控范围以内的事情。</span></p>

<p class=MsoNormal><b><span lang=EN-US>&nbsp;</span></b></p>

<h3><a name="_Toc495916520"><span class=2><span lang=EN-US style='font-family:
"Calibri",sans-serif'>3.3.2 </span></span></a><span class=2><span
style='font-family:宋体'>服务器端混流</span></span></h3>

<h4><strong><span style='font-family:宋体;font-weight:normal'>优点</span></strong></h4>

<p class=MsoNoSpacing><b><span lang=EN-US style='color:black;background:white'>1)
</span></b><b><span style='font-family:宋体;color:black;background:white'>低延迟</span></b></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>在服务端混流，天然地具有低延迟的特点。在服务端混流只需要等待所有其它主播的音视频流到达服务端就可以开始混流；在这个基础上，在推流端混流还要从服务端再拉流到推流端，要等待所有其它主播的音视频流被拉下来后才可以开始混流。在服务端混流的系统设计天然地比在推流端混流减少了这一段的网络传输的时间。另外，服务端的计算能力和网络带宽都是要比推流端高几个量级的，混流的过程和推流到</span><span
lang=EN-US style='color:black;background:white'>CDN</span><span
style='font-family:宋体;color:black;background:white'>网络所耗费的时间，在服务端都会比推流端要来得少。综合起来，服务端混流可以获得比推流端混流低的延迟。</span></p>

<p class=MsoNoSpacing><b><span lang=EN-US style='color:black;background:white'>2)
&nbsp;</span></b><b><span style='font-family:宋体;color:black;background:white'>计算资源充足</span></b></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>服务端的计算资源相对充足，而且可以进行扩展和调度，不会成为瓶颈。</span></p>

<p class=MsoNoSpacing><b><span lang=EN-US style='color:black;background:white'>3)
&nbsp;</span></b><b><span style='font-family:宋体;color:black;background:white'>网络带宽资源充足</span></b></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>服务端的网络带宽相对充足，而且可以进行扩展和调度，不会成为瓶颈。</span></p>

<p class=MsoNoSpacing><b><span lang=EN-US style='color:black;background:white'>&nbsp;4)&nbsp;
</span></b><b><span style='font-family:宋体;color:black;background:white'>可控可扩展</span></b></p>

<p class=MsoNoSpacing style='text-indent:26.25pt'><span style='font-family:
宋体;color:black;background:white'>其实这是服务端最大的优势。在服务端有着云服务平台充沛的资源，可以进行弹性的调整和扩展，有着专业团队专业的服务和强力的支持。这是云服务平台的优势；这是集团军作战的方式；这是靠组织打硬仗的理念。说得通俗一点，一般情况下，</span><span
lang=EN-US style='color:black;background:white'>1</span><span style='font-family:
宋体;color:black;background:white'>个核可以支持</span><span lang=EN-US
style='color:black;background:white'>5</span><span style='font-family:宋体;
color:black;background:white'>路流，</span><span lang=EN-US style='color:black;
background:white'>8</span><span style='font-family:宋体;color:black;background:
white'>个核就可以支持</span><span lang=EN-US style='color:black;background:white'>40</span><span
style='font-family:宋体;color:black;background:white'>路流，随着流不断增加，可以不断增加</span><span
lang=EN-US style='color:black;background:white'>CPU</span><span
style='font-family:宋体;color:black;background:white'>，无感知地增强计算能力。换成终端手机的话，是没办法增加</span><span
lang=EN-US style='color:black;background:white'>CPU</span><span
style='font-family:宋体;color:black;background:white'>的，要么换手机，要么只能等着烧糊。</span></p>

<h4><strong><span style='font-family:宋体;font-weight:normal'>缺点</span></strong></h4>

<p class=MsoNoSpacing><b><span lang=EN-US style='color:black;background:white'>1)&nbsp;
</span></b><b><span style='font-family:宋体;color:black;background:white'>成本高</span></b></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>在服务端混流，会让服务端承担了额外的计算成本和网络带宽成本，从而推高运营成本。</span></p>

<p class=MsoNoSpacing><b><span lang=EN-US style='color:black;background:white'>2)&nbsp;
</span></b><b><span style='font-family:宋体;color:black;background:white'>压力大</span></b></p>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体;
color:black;background:white'>在服务端混流，也叫作集中式混流。音视频流的带宽压力，以及转码和混流的计算压力都会汇集到服务端，天然地增加服务端的压力。这个情况也对服务端的架构设计提出挑战，要求服务端能够有扩展性，能够通过分布式和集群的方式来应对压力。</span></p>

<p class=MsoNoSpacing><span lang=EN-US>&nbsp;</span></p>

<h1><a name="_Toc495916521"><span lang=EN-US>4 </span></a><span
style='font-family:宋体'>连麦互动方案设计</span></h1>

<p class=MsoNoSpacing style='text-indent:21.0pt'><span style='font-family:宋体'>针对目前我们的直播系统，实时音视频系统架构，以及以上介绍常用的互动直播解决方案，设计几种连麦方案。</span></p>

<h2><a name="_Toc495916522"><span lang=EN-US>4.1 </span></a><span
style='font-family:宋体'>服务器混流方案设计</span></h2>

<h3><a name="_Toc495916523"><span lang=EN-US>4.1.1&nbsp; </span></a><span
style='font-family:宋体'>互动直播</span><span lang=EN-US>(</span><span
style='font-family:宋体'>连麦</span><span lang=EN-US>)</span></h3>

<p class=MsoNoSpacing><span lang=EN-US><img width=847 height=1003
src="live_talk.files/image004.png"></span></p>

<p class=MsoNoSpacing><span style='font-family:宋体'>流程描述</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>首先主播通过传统直播推流到直播系统中</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>观众选择该主播，观看直播</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>主播在直播房间中，邀请观众互动，或观众申请与主播互动</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>主播通过</span><span lang=EN-US>IM</span><span
style='font-family:宋体'>发送连麦邀请后，观众收到邀请，同意加入连麦</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>主播收到观众同意加入连麦后，开始向会控管理创建会议，同时加班会议</span>
</p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>会议系统返回与会相关信息，包抱会议号，</span><span
lang=EN-US>MAS</span><span style='font-family:宋体'>接入参数等，同时将会议号通过</span><span
lang=EN-US>IM</span><span style='font-family:宋体'>通知连麦观众。观众收会议号，向会控管理加班该会议</span><span
lang=EN-US>,</span><span style='font-family:宋体'>会控管理向观从返回与会相关信息</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>7.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>主播通过</span><span lang=EN-US>MAS</span><span
style='font-family:宋体'>接入信息，向会议发送本地音视频信息，同时接收连麦观众音视频信息</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt'><span style='font-family:宋体'>连麦观众通过</span><span
lang=EN-US>MAS</span><span style='font-family:宋体'>，向会方发送本地音视频信息，同时接收主播音视频信息</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>8.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>主播断开之前</span><span lang=EN-US>rtmp</span><span
style='font-family:宋体'>推流，停止当前</span><span lang=EN-US>rtmp</span><span
style='font-family:宋体'>流</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>9.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>同时主播向连麦管理发送连麦通知，连麦管理发收到通知后，根据当前频道后，从直播系统获取</span><span
lang=EN-US>rtmp</span><span style='font-family:宋体'>地址，该地址是混流后推流地址。同时将会议号，推流地址等参数，通知</span><span
lang=EN-US>mcs</span><span style='font-family:宋体'>开始混流，</span><span lang=EN-US>
mcs</span><span style='font-family:宋体'>分别向</span><span lang=EN-US>mps,mcuc</span><span
style='font-family:宋体'>通知开始混音，混屏，同时通知</span><span lang=EN-US>mlg</span><span
style='font-family:宋体'>将将会议混音，混屏的流转封装成</span><span lang=EN-US>rtmp</span><span
style='font-family:宋体'>流，推流到直播系统。</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>10.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:宋体'>其他观众选择该主播频道，从直播系统拉流观看，主播与连麦观混音混屏的音视频流。</span></p>

<h3><a name="_Toc495916524"><span lang=EN-US>4.1.2&nbsp; </span></a><span
style='font-family:宋体'>会议直播</span><span lang=EN-US>(</span><span
style='font-family:宋体'>旁路直播</span><span lang=EN-US>)</span></h3>

<p class=MsoNoSpacing><span lang=EN-US><img width=818 height=852
src="live_talk.files/image005.png"></span></p>

<p class=MsoNoSpacing><span style='font-family:宋体'>流程描述：</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>首先是根据会议流程，将两人或多人加入会议，进行会议交流</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>其他观众不需要参与会议，只需观看会议内容。</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>直播系统通过会控管理获取会议列表，生成会议与直播频道映射关系</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>观众选择一个会议，观看这个会议内容</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>直播系统收到观看请求，首先检查该会议是否正在直播系统，如是正在直播，返回直播内容，否则直播系统发送请求观看会议到旁路直播管理，旁路直播通知</span><span
lang=EN-US>mcs</span><span style='font-family:宋体'>，</span><span lang=EN-US>mcs</span><span
style='font-family:宋体'>通知</span><span lang=EN-US>mps,mcu</span><span
style='font-family:宋体'>混音混屏，通知</span><span lang=EN-US>mlg</span><span
style='font-family:宋体'>将会议推送到直播系统</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p>

<h3><a name="_Toc495916525"><span lang=EN-US>4.1.3 &nbsp;</span></a><span
style='font-family:宋体'>客户端混流方案设计</span></h3>

<p class=MsoNoSpacing><span lang=EN-US><img width=847 height=781
src="live_talk.files/image006.png"></span></p>

<p class=MsoNoSpacing><span style='font-family:宋体'>流程描述</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>首先主播通过传统直播推流到直播系统中</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>观众选择该主播，观看直播</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>主播在直播房间中，邀请观众互动，或观众申请与主播互动</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>主播通过</span><span lang=EN-US>IM</span><span
style='font-family:宋体'>发送连麦邀请后，观众收到邀请，同意加入连麦</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>主播收到观众同意加入连麦后，开始向会控管理创建会议，同时加班会议</span>
</p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>会议系统返回与会相关信息，包抱会议号，</span><span
lang=EN-US>MAS</span><span style='font-family:宋体'>接入参数等，同时将会议号通过</span><span
lang=EN-US>IM</span><span style='font-family:宋体'>通知连麦观众。观众收会议号，向会控管理加班该会议</span><span
lang=EN-US>,</span><span style='font-family:宋体'>会控管理向观从返回与会相关信息</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>7.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>主播通过</span><span lang=EN-US>MAS</span><span
style='font-family:宋体'>接入信息，向会议发送本地音视频信息，同时接收连麦观众音视频信息</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt'><span style='font-family:宋体'>连麦观众通过</span><span
lang=EN-US>MAS</span><span style='font-family:宋体'>，向会方发送本地音视频信息，同时接收主播音视频信息</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>8.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>主播断开之前</span><span lang=EN-US>rtmp</span><span
style='font-family:宋体'>推流，停止当前</span><span lang=EN-US>rtmp</span><span
style='font-family:宋体'>流，将主播与观众音视频合流后，使用</span><span lang=EN-US>rtmp</span><span
style='font-family:宋体'>流推送到直播系统</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>9.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>其他观众选择该主播频道，从直播系统拉流观看，主播与连麦观混音混屏的音视频流。</span></p>

<p class=MsoNoSpacing style='margin-left:18.0pt'><span lang=EN-US>&nbsp;</span></p>

</div>

</body>

</html>
